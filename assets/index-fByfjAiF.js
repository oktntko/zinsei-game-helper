import{_ as N,a as P}from"./InputCommafyNumber.vue_vue_type_script_setup_true_lang-Nf95b95v.js";import{d as j,b as V,e as T,a as A}from"./index-rI2ba7fC.js";import{d as w,b as g,k as L,c,o as p,e as t,y as R,F as M,l as C,z as b,h as s,t as v,i as E,_ as F,A as h,g as U,B as I,C as G,D as H,E as J,G as K,n as B,a as _,x as S,H as O,r as Q,q as W,p as z}from"./index-CBNPx-hI.js";import{u as X}from"./index-DqhHmUM9.js";import{p as q}from"./chunk-2OQBQB3V-BlqUrAW7.js";import"./chunk-A3PVMI4K-M-spppvk.js";const Y={class:"flex flex-col items-center justify-center overflow-hidden px-8 pb-4 pt-12"},Z={class:"h-80 w-80 rounded-full shadow-[0_0_4px_4px_rgba(0,0,0,0.25)] sm:h-96 sm:w-96"},ee={class:"inline-block -rotate-90"},te={class:"relative py-4 text-3xl"},le={key:0,class:"ml-16 font-bold text-blue-600 dark:text-blue-500"},se=w({__name:"ModalSpinwheel",props:{size:{default:10}},setup(m){const i=g(),e=g({degree:0,spinResult:1,spinning:void 0}),a=g();function u(){if(!i.value)return;e.value.spinning=!0;for(const l of Array.from(i.value.children))l.classList.remove("highlight");const d=Math.random()*360+1800,o=e.value.degree+d;a.value=i.value.animate([{transform:`rotate(${e.value.degree}deg)`},{transform:`rotate(${o}deg)`}],{duration:3e3,direction:"normal",easing:"cubic-bezier(0.5, -0.25, 0.000, 1.005)",fill:"forwards",iterations:1});function n(l){var x;e.value.spinning=!1,a.value=void 0,(x=i.value)==null||x.children[e.value.spinResult-1].classList.add("highlight")}a.value.onfinish=n,a.value.oncancel=n,a.value.onremove=n,e.value.degree=o;const f=Math.abs(e.value.degree%360-360);e.value.spinResult=Math.trunc(f/(360/m.size))+1}function r(){var d;(d=a.value)==null||d.finish()}return L(()=>{setTimeout(u,180)}),(d,o)=>(p(),c("div",Y,[t("div",Z,[t("div",{class:"ui-wheel-of-fortune",style:R({"--_items":d.size})},[t("ul",{ref_key:"wheel",ref:i},[(p(!0),c(M,null,C(Array.from({length:d.size}),(n,f)=>(p(),c("li",{key:f},[t("div",null,[t("span",ee,v(f+1),1)])]))),128))],512),t("button",{type:"button",class:b(["aspect-square place-self-center rounded-full border-none bg-white/80","w-[20cqi]","transition-colors duration-150 disabled:cursor-wait disabled:bg-gray-100/80 disabled:text-gray-500"]),onClick:o[0]||(o[0]=()=>s(e).spinning?r():u())},v(s(e).spinning?"":"まわす"),1)],4)]),t("div",te,[s(e).spinning===!1?(p(),c("span",le,[E(v(s(e).spinResult)+" ",1),o[1]||(o[1]=t("span",{class:"text-sm text-gray-900"}," が でたよ",-1))])):(p(),c("span",{key:1,class:b(["animate-pulse text-gray-300",[s(e).spinning===void 0?"invisible":""]])}," ... ",2))])]))}}),ae=F(se,[["__scopeId","data-v-aca6a9e7"]]),oe={class:"relative inline-flex h-8 w-[60px] cursor-pointer gap-1 p-1 text-white"},ne=w({__name:"TogglePlusMinus",props:{modelValue:{type:Boolean,required:!1,default:!0},modelModifiers:{}},emits:["update:modelValue"],setup(m){const i=h(m,"modelValue");return(e,a)=>(p(),c("label",oe,[a[1]||(a[1]=t("span",{class:"icon-[typcn--minus] z-10 h-6 w-6"},null,-1)),a[2]||(a[2]=t("span",{class:"icon-[typcn--plus] z-10 h-6 w-6"},null,-1)),U(t("input",{"onUpdate:modelValue":a[0]||(a[0]=u=>i.value=u),type:"checkbox",class:"hidden"},null,512),[[I,i.value]]),t("div",{class:b(["absolute inset-0 h-full w-full rounded-3xl transition-colors",["before:absolute before:top-1 before:z-20 before:block before:h-6 before:w-6 before:rounded-full before:shadow-lg before:transition-all",i.value?"bg-blue-500 shadow-[0_0_2px_2px_rgba(37,99,235,0.25)]":"bg-red-500 shadow-[0_0_2px_2px_rgba(220,38,38,0.25)]",i.value?"before:left-1 before:bg-blue-100":"before:left-8 before:bg-red-100"]])},null,2)]))}}),re=["value"],ie=["src"],ue={class:"text-2xl font-bold tracking-tight text-gray-900 dark:text-white"},de={class:"flex grow flex-col justify-center gap-1"},pe={key:1,class:"relative flex items-end justify-center gap-2"},ce={class:"text-2xl"},fe={class:"max-w-40 text-3xl leading-none"},me={class:"flex items-center justify-center gap-2"},ve={class:"ml-[60px] inline-flex flex-1 gap-1"},ge=["onClick"],be=w({__name:"Player",props:G({game:{},current:{}},{player:{required:!0},playerModifiers:{},turn:{required:!0},turnModifiers:{}}),emits:["update:player","update:turn"],setup(m){const i=m,e=h(m,"player"),a=h(m,"turn"),u=g(!0),r=H(()=>e.value.point-i.current.point),d=g();return J(()=>{var o;a.value===e.value.order&&((o=d.value)==null||o.focus())}),(o,n)=>{const f=N;return p(),c("div",{class:b(["relative flex w-full grow flex-col justify-center gap-2 rounded bg-white transition-colors",[a.value===e.value.order?"border-8 p-6":"border-4 p-7"]]),style:R({"border-color":a.value===e.value.order?`rgb(${e.value.color})`:`rgba(${e.value.color},0.6)`})},[t("div",null,[t("label",{class:b(["inline-flex cursor-pointer items-center gap-1",["before:h-6 before:w-6 before:rounded-full before:border before:border-gray-200 before:bg-gray-50 before:transition-all",a.value===e.value.order?"before:bg-green-400 before:shadow-[inset_0_0_0_4px_rgba(243,244,246,0.9)]":""]])},[U(t("input",{ref_key:"refRadio",ref:d,"onUpdate:modelValue":n[0]||(n[0]=l=>a.value=l),type:"radio",class:"absolute opacity-0",value:e.value.order},null,8,re),[[K,a.value]]),t("img",{src:e.value.image,width:"40",height:"40",class:"h-10 w-10"},null,8,ie),t("h5",ue,v(e.value.name),1)],2)]),t("div",de,[s(r)===0?(p(),B(f,{key:0,modelValue:e.value.point,"onUpdate:modelValue":n[1]||(n[1]=l=>e.value.point=l),modelModifiers:{lazy:!0},class:"w-full items-center justify-center text-center text-3xl leading-none",type:"number",step:o.game.step},null,8,["modelValue","step"])):(p(),c("div",pe,[t("div",ce,v(o.current.point.toLocaleString()),1),t("div",{class:b(["text-xl",[s(r)>0?"text-blue-600":"text-red-600"]])},v(s(r)>0?"+":"-"),3),t("div",{class:b(["text-2xl",[s(r)>0?"text-blue-600":"text-red-600"]])},v(Math.abs(s(r)).toLocaleString()),3),n[6]||(n[6]=t("div",{class:"text-xl"},"=",-1)),t("div",fe,[_(f,{modelValue:e.value.point,"onUpdate:modelValue":n[2]||(n[2]=l=>e.value.point=l),class:"w-full text-center",type:"number",step:o.game.step},null,8,["modelValue","step"])]),t("button",{type:"button",class:"absolute -right-4 -top-3 h-6 w-6 rounded-full bg-transparent text-gray-400 transition-colors hover:text-gray-900 focus:ring-2 focus:ring-gray-300 dark:text-gray-500 dark:hover:text-white",onClick:n[3]||(n[3]=async()=>{await o.$dialog.confirm(`${e.value.name} の ポイント を もとにもどしますか？`)&&(e.value.point=o.current.point)})},n[5]||(n[5]=[t("span",{class:"icon-[bi--x] h-6 w-6"},null,-1)]))])),t("div",me,[t("div",ve,[(p(),c(M,null,C([1,10],l=>t("div",{key:l,class:"flex-1"},[t("button",{class:b(["w-full rounded-md border bg-white px-2 py-1 text-sm text-gray-900 transition-all disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none",[s(u)?"border-blue-400 hover:bg-blue-100 hover:shadow-[0_0_2px_2px_rgba(96,165,250,0.25)] focus:bg-blue-100 focus:shadow-[0_0_2px_2px_rgba(96,165,250,0.25)] active:bg-blue-100 active:shadow-[0_0_2px_2px_rgba(96,165,250,0.25)]":"border-red-400 hover:bg-red-100 hover:shadow-[0_0_2px_2px_rgba(248,113,113,0.25)] focus:bg-red-100 focus:shadow-[0_0_2px_2px_rgba(248,113,113,0.25)] active:bg-red-100 active:shadow-[0_0_2px_2px_rgba(248,113,113,0.25)]"]]),type:"button",onClick:()=>{e.value.point=e.value.point+(s(u)?1:-1)*(o.game.step*l)}},v(s(u)?"+":"-")+v((o.game.step*l).toLocaleString()),11,ge)])),64))]),_(ne,{modelValue:s(u),"onUpdate:modelValue":n[4]||(n[4]=l=>S(u)?u.value=l:null)},null,8,["modelValue"])])])],6)}}}),xe={class:"flex h-dvh flex-col overflow-hidden"},ye={class:"z-10 flex shrink-0 justify-center gap-2 rounded-b-sm bg-gray-600 px-2 py-2 shadow"},_e={class:"flex-1 overflow-hidden truncate text-2xl text-yellow-500"},he={key:0,class:"flex flex-1 snap-y snap-mandatory flex-col gap-1 overflow-y-auto scroll-smooth p-1 sm:gap-2 sm:p-2"},we={class:"z-10 flex h-12 shrink-0 justify-center rounded-t-sm bg-white/70 text-gray-900 shadow backdrop-blur"},ke={class:"ms-6 flex h-full flex-1 justify-center"},$e=["disabled"],Ve=["disabled"],Me=["disabled"],Ce=["disabled"],Be=w({__name:"index",props:{modelValue:{required:!0},modelModifiers:{},player_list:{required:!0},player_listModifiers:{}},emits:["update:modelValue","update:player_list"],setup(m){const i=h(m,"modelValue"),e=h(m,"player_list"),a=g([]),u=g([]),r=g(0);X(`あそび | ${i.value.name}`),L(()=>{u.value=q(e.value),r.value=0});const d=g(!1),o=O();async function n(){d.value=!0;try{for(const l of e.value)await j.update(V).set(l).where(T(V.player_id,l.player_id));const f=await j.query.players.findMany({where:(l,{eq:x})=>x(l.game_id,i.value.game_id),orderBy:A(V.order)});a.value.unshift(q(u.value)),u.value=e.value,e.value=f,r.value=r.value+1<e.value.length?r.value+1:0,o.success(`${e.value[r.value].name} のばんだよ`)}finally{d.value=!1}}return(f,l)=>{const x=Q("RouterLink"),D=P;return p(),c("div",xe,[t("header",ye,[_(x,{to:{name:"/game/"},class:"group/item inline-flex flex-col items-center justify-center text-gray-300"},{default:z(()=>l[3]||(l[3]=[t("div",{class:"icon-[weui--back2-outlined] h-6 w-6 transition-transform duration-100 group-hover/item:scale-125"},null,-1)])),_:1}),t("div",_e,v(i.value.name),1),_(x,{to:{name:"/game/[game_id]/setting/",params:{game_id:i.value.game_id}},class:"group/item inline-flex flex-col items-center justify-center text-gray-300"},{default:z(()=>l[4]||(l[4]=[t("div",{class:"icon-[uil--setting] h-6 w-6 transition-transform duration-100 group-hover/item:scale-125"},null,-1)])),_:1},8,["to"])]),s(u).length?(p(),c("main",he,[(p(!0),c(M,null,C(e.value,(y,k)=>(p(),B(be,{key:y.player_id,player:e.value[k],"onUpdate:player":$=>e.value[k]=$,turn:s(r),"onUpdate:turn":l[0]||(l[0]=$=>S(r)?r.value=$:null),current:s(u)[k],game:i.value},null,8,["player","onUpdate:player","turn","current","game"]))),128))])):W("",!0),t("footer",we,[t("div",ke,[t("button",{type:"button",class:"group/item inline-flex flex-1 flex-col items-center justify-center",disabled:s(d)},l[5]||(l[5]=[t("span",{class:"icon-[solar--menu-dots-circle-broken] h-6 w-6 transition-transform duration-100 group-hover/item:scale-125"},null,-1),t("span",{class:"text-xs"}," メニュー ",-1)]),8,$e),t("button",{type:"button",class:"group/item inline-flex flex-1 flex-col items-center justify-center disabled:text-gray-500",disabled:s(d),onClick:l[1]||(l[1]=()=>{const y=s(a).shift();y?(u.value=y,e.value=y,r.value=s(r)-1>=0?s(r)-1:e.value.length-1,s(o).success("まえにもどしたよ")):s(o).info("もうもどせないよ")})},l[6]||(l[6]=[t("span",{class:"icon-[mynaui--undo-solid] h-6 w-6 transition-transform duration-100 group-hover/item:scale-125"},null,-1),t("span",{class:"text-xs"}," まえにもどす ",-1)]),8,Ve),t("button",{type:"button",class:"group/item inline-flex flex-1 flex-col items-center justify-center",disabled:s(d),onClick:n},l[7]||(l[7]=[t("span",{class:"icon-[formkit--submit] h-6 w-6 transition-transform duration-100 group-hover/item:scale-125"},null,-1),t("span",{class:"text-xs"}," つぎへ ",-1)]),8,Me)]),t("button",{type:"button",class:"relative w-16",disabled:s(d),onClick:l[2]||(l[2]=async()=>{await f.$modal.open({component:ae})})},[_(D,{class:"absolute bottom-[-12px] right-[-12px] h-20 w-20 -rotate-12 transition-transform duration-100 hover:scale-125"})],8,Ce)])])}}});export{Be as default};
